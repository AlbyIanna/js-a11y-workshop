import CodeBlock from "../templates/code-figure"
import Slide from "../templates/slide"
import ImageSlide from "../templates/image-slide"
import AccessibleAnimationDemo from "../components/good/animation"
import highlight from '@mdx-deck/themes/syntax-highlighter-prism'
// import Appear from "@mdx-deck/components/appear"

import baseTheme from './theme'
export const themes = [baseTheme, highlight]

<Slide>

# Accessibility in<br />JavaScript Applications

</Slide>

---

<Slide>

<div style="margin-top: -3em">
    <h1>Who is Marcy Sutton?</h1>
</div>

<div style="position: relative; margin:0 auto; max-width: 300px;">
    <img src="/gatsby-icon.png" alt="Gatsby" style="position:absolute; left: -200px; max-height: 130px; top:30px;" />
    <img src="/marcysutton-sketch.png" alt="Sketch note portrait of Marcy by Maggie Appleton" style="max-height: 400px; margin-bottom: 200px;" />
    <img src="/a11y-octopus.png" alt="A11y Octopus" style="position:absolute; right: -240px; top: 30px; max-height: 180px;" />
    <img src="/axe-logo.png" alt="axe"  style="position:absolute; top: 280px; left: -20px; max-height: 130px;" />
    <img src="/angular-logo.png" alt="Angular" style="position:absolute; top: 280px; left: 70%; max-height: 125px;" />
</div>
<p style="margin: 0;">
    <a href="https://twitter.com/marcysutton">@marcysutton</a>&nbsp;~&nbsp;<a href="https://marcysutton.com">marcysutton.com</a>
</p>

</Slide>

---

<Slide>

# Accessibility

Making the web more inclusive <br />
**_with_** _and_ **_for_ people with disabilities**

</Slide>

---

<Slide>

# Accessibility is a civil right

Notes: human right? How to make this global while keeping with the original spirit of the blog post

https://www.deque.com/blog/javascript-and-civil-rights/

</Slide>

---

<Slide>

# JavaScript Applications

- Client-rendered‚Äìno traditional page reloads
- Built with frameworks: React, Vue, Ember, Angular, etc.
- Sometimes server-rendered with ‚Äúhydration‚Äù
- Challenges and opportunities

</Slide>

---

# What we‚Äôll cover

<div style="font-size: 2.8rem;">

- Accessibility debugging

- Accessibility in JavaScript apps
    - Focus management
    - Announcements
    - Semantic HTML
    - Unobtrusive motion
    - Progressive enhancement


- Accessibility units
- Accessible pages
- Q & A

</div>

---

<Slide>

# Web accessibility in the wild

</Slide>

---

<ImageSlide
    heading="Examples of inaccessible web applications: 1"
    imageSrc="/slack-json-viewer.gif"
    imageAlt="Slack JSON file viewer"
/>

---

<ImageSlide
    heading="Examples of inaccessible web applications: 2"
    imageSrc="/user-inyerface.jpg"
    imageAlt="User in-yer-face"
/>

---

<ImageSlide
    heading="Examples of better web applications: 1"
    imageSrc="/blackboard.png"
    imageAlt="Blackboard Learn application"
/>

---

<ImageSlide
    heading="Examples of better web applications: 2"
    imageSrc="/facebook-a11y-toolbar.jpg"
    imageAlt="Facebook's accessibility toolbar"
/>

---

<ImageSlide
    heading="Examples of better web applications: 3"
    imageSrc="/github-gatsby-sweet-pupperino.png"
    imageAlt="Gatsby on Github with a special tag"
/>

---

<ImageSlide
    heading="Examples of better web applications: 4"
    imageSrc="/googlemaps.gif"
    imageAlt="Google Maps keyboard access searching for bakeries in the San Juan Islands"
/>

---

<Slide>

<div style="margin-top: -2em">

# Install time

</div>

## App + Workshop slides
- https://github.com/marcysutton/js-a11y-workshop

## Tools

- Your keyboard
- http://bit.ly/axe-chrome
- https://accessibilityinsights.io
- https://nvaccess.org/download

</Slide>

---

<Slide>

# Install workshop materials

```shell
git clone git@github.com:marcysutton/js-a11y-workshop.git
npm install
gatsby develop
```

View the app: http://localhost:8000

Presentation slides: http://localhost:8000/slides

</Slide>

---

<Slide>

# An app for today

- Sandbox for accessible JS
- Built with Gatsby and React
- MDX for components in Markdown
- Outputs HTML pages by default

</Slide>

---

<Slide>

# Which.js?

- React
- Ember
- Angular
- Polymer
- Vue
- Svelte
- Vanilla

</Slide>

---

<Slide>

# It doesn‚Äôt matter.
## People just want to use your site

![Elmo](/elmo-shrug-once.gif)

</Slide>

---

# Framework guides

- [Reactjs.org](https://reactjs.org/docs/accessibility.html)
- [Emberjs.com](https://guides.emberjs.com/release/reference/accessibility-guide/)
- [Angular.io](https://angular.io/guide/accessibility) !!!
- [Polymer: GoogleIO](https://developers.google.com/web/shows/google-io/2014/polymer-making-web-components-accessible)
- Vue: coming soon!

---

# Hybrid mobile apps

- [Mobile Accessibility at W3C](https://www.w3.org/WAI/standards-guidelines/mobile/)
- [React Native docs](https://facebook.github.io/react-native/docs/accessibility)
- [Ionic Framework](https://ionicframework.com/docs/native/mobile-accessibility)

---

# Responsive design is good<br />for accessibility

<img alt="zoomed-in view of a desktop prototype" src="/magnification-a11y.png" style="margin-top: 1em; max-height: 600px;" />

---

<Slide>

# Web Accessibility Debugging

<div style="font-size: 6rem; margin-top: 1rem;">
    <span aria-label="magnifying glass" role="img">üîç</span>
</div>

</Slide>

---

<Slide>

# #A11y debugging steps

- Render in a web browser
- Test controls with the keyboard
- Use accessibility web extensions
- Check color contrast
- Test with screen readers
- Use magnification & zoom

</Slide>

---

<Slide>

# Live debugging demo

</Slide>

---

<Slide>

# Prototyping with [Parcel](https://parceljs.org/)

<CodeBlock>

```shell
$ npm install parcel-bundler -g

$ parcel index.html
```

</CodeBlock>

</Slide>

---

<Slide>

<div style="margin-top: -2em">

# [Parceljs.org](https://parceljs.org/)

</div>

## Test with any modern JS framework

<CodeBlock title="index.html" side="left">

```html
<!DOCTYPE html>
<html>
    <title>React Routing Test</title>
<body>
    <div id="app"></div>
    <script src="./index.js"></script>
</body>
</html>
```

</CodeBlock>

<CodeBlock title="index.js" side="right">

```jsx
import React from "react"
import ReactDOM from "react-dom"

const App = () => (
    <main>
        <h1>React Demo</h1>
    </main>
)
ReactDOM.render(<App />, document.getElementById("app"))
```

</CodeBlock>

</Slide>

---

<Slide>

# Debugging in this Gatsby app
Fire up a build in a browser and start testing

<CodeBlock side="left">

```shell
$ gatsby build && gatsby serve
```

</CodeBlock>

<p style="margin-top:2rem;"><small>http://localhost:9000</small></p>

</Slide>

---

<Slide>

# Keyboard debugging tips

- Interactive controls only
- Focus indicators
- Hidden vs. visible CSS
- Force element state in DevTools

</Slide>

---

<Slide>

# Hidden vs. Visible CSS

<CodeBlock side="left">

```css
.visuallyhidden { 
	border: 0;
	clip: rect(0 0 0 0);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
}
```

</CodeBlock>

<CodeBlock side="right">

```css
.opacity {
	opacity: 0;
}
.displayNone {
	display: none;
}
.visibility {
	visibility: hidden;
}
```

</CodeBlock>

</Slide>

---

<Slide>

# The accessibility tree

## A parallel structure to the DOM

Uses platform Accessibility APIs to communicate page<br /> structure & content to assistive technologies

![Chrome accessibility tree dump](/chrome-accessibility-tree.png)

</Slide>

---

<Slide>

# Visualize with browser DevTools

Semantic markup and CSS styles impact the accessibility tree

![Chrome DevTools accessibility inspector](/chrome-a11y-inspector.png)

</Slide>

---

<Slide>

# Focus testing haxx

## Paste into browser devTools console

```js
document.body.addEventListener('focusin', (event) => {
    console.log(document.activeElement)
})

```

</Slide>

---

<Slide>

# Exercise 1
## Play with keyboard testing

![a wooden doll thing repeatedly hitting a keyboard](/keyboard.gif)

</Slide>

---

<Slide>

# Exercise 2
## Run a browser extension

- [axe](https://deque.com/axe)
- [Accessibility Insights](https://accessibilityinsights.io)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse/)
- [WAVE](https://wave.webaim.org/extension/)
- [NoCoffee](https://chrome.google.com/webstore/detail/nocoffee/jjeeggmbnhckmgdhmgdckeigabjfbddl?hl=en-US)

</Slide>

---

<Slide>

# Exercise 3
## Test with accessibility devTools

- [Chrome color picker & accessibility pane](https://developers.google.com/web/tools/chrome-devtools/accessibility/reference#pane)
- [Firefox accessibility tools](https://developer.mozilla.org/en-US/docs/Tools/Accessibility_inspector#Accessing_the_Accessibility_Inspector)

</Slide>

---

<Slide>

# Testing with Screen Readers

Cheat sheets for getting started
- https://webaim.org/articles/voiceover/
- https://webaim.org/articles/nvda/
- https://webaim.org/articles/jaws/

</Slide>

---

<Slide>

# Exercise 4
## Screen reader testing

- OSX Voiceover
- NVDA and Firefox
- JAWS and IE11 or Edge
- iOS Voiceover and Safari
- Android TalkBack and Chrome
- Orca on Linux

</Slide>

---

<Slide>

# Magnification
## For users with low vision

- Browser zoom
- OS-level zoom
- ZoomText & other apps

</Slide>

---

<Slide>

# Exercise 5
## Test with magnification

Things to watch out for:

- Page scrolling
- Font sizes & scaling
- UX of interactions when zoomed

</Slide>

---

<Slide>

# Accessibility is an ongoing effort<br />and a culture
It requires strategy, patience and teamwork: one sprint and pull request at a time

![Cookie Monster's artwork strategy](/strategic-cookie-monster-once.gif)

</Slide>

---

<Slide>

# Intro to Accessibility in JS Apps

<img src="/finally.webp" alt="finally" style="min-width: 400px;" />

</Slide>

---

<Slide>

<img src="/mythbusters.png" alt="mythbusters" style="max-width: 500px;" />

# JavaScript is an important part of<br />accessible web applications

</Slide>

---

<Slide>

# Accessible JavaScript Apps
Common techniques & requirements

- Focus management
- Live Region announcements
- Semantic HTML
- Unobtrusive motion
- Progressive enhancement

</Slide>

---

<Slide>

# Focus management

Moving the user's focus after interaction or navigation <br /> to alert them to new content

- make content visible
- get keyboard users to the right place
- expose it to Assistive Tech
- disable irrelevant parts of the page

</Slide>

---

<Slide>

# Navigation vs. Actions
## a.k.a. Links vs. Buttons

<CodeBlock side="left">
```html
<a href="/page">Page</a>
```
</CodeBlock>

<CodeBlock side="right">
```jsx
<button onClick={action}>Thing</button>
```
</CodeBlock>

https://marcysutton.com/links-vs-buttons-in-modern-web-applications

</Slide>

---

<Slide>

# tabindex in HTML

<CodeBlock>

```javascript
tabIndex="0"        // in the tab order
tabIndex="-1"       // focusable by script only
tabIndex="99641"    // all up in your tab order
```

</CodeBlock>

</Slide>

---

<Slide>

# tabindex + role + name

<CodeBlock side="left">

```html
<div tabIndex="0"
     role="button"
     aria-label="Close">   
</div>
```

</CodeBlock>

<CodeBlock side="right">

```js

// focusable
// a button widget, not a DIV
// an accessible name
 
```

</CodeBlock>

</Slide>

---


<Slide>

# tabindex + role + name + events

<CodeBlock side="left">

```jsx
<div tabIndex="0"
     role="button"
     aria-label="Close"
     onClick={clickHandler}
     onKeyDown={keydownHandler}>   
</div>
```

</CodeBlock>


<CodeBlock side="right">

```jsx
<button aria-label="Close"
        onClick={clickHandler}>   
</button>
```

</CodeBlock>

</Slide>

---

<Slide>

# ARIA: Accessible<br />Rich Internet Applications

https://www.w3.org/TR/wai-aria-1.1/

- **role**: what is it?
- **state**: what's happening to it?
- **property**: what's the nature of it?

</Slide>

---

# The Rules of ARIA
https://www.w3.org/TR/using-aria/

> **The first rule of ARIA is _don‚Äôt use it_**:<br />use native HTML elements first when available

---

<Slide>

# Focus management<br />patterns

- Dropdowns and menus
- Layers and modals
- View changes and deletes
- Loading screens

</Slide>

---

<Slide>

# Focus management<br />patterns (cont‚Äòd)

- Component handling
- React refs, Vue $refs
- Other framework APIs
- Focus manager APIs

</Slide>

---

<Slide>

# Exercise
## Dropdown demo

- React: http://localhost:8000/dropdown
- vanilla.js: https://codepen.io/marcysutton/pen/JgjYVv

</Slide>

---

<Slide>

# Announcements using<br />ARIA Live Regions

![BBC GIF with a young girl with a megaphone saying attention please](/announcement.webp)

</Slide>

---

<Slide>

# Announcement patterns
Notify assistive tech users without moving focus

- Asynchronous save / update / etc.
- Combobox usage / list filtering
- Chat widgets
- Title changes*

</Slide>

---

<Slide>

# ARIA Live Regions
Message command centers of varying importance

https://www.w3.org/TR/wai-aria/#live_region_roles

<CodeBlock side="left">

```html
<div role="status"></div>
<div role="alert"></div>
```

</CodeBlock>

<CodeBlock side="right">

```html
<div aria-live="polite"></div>
<div aria-live="assertive"></div>
```

</CodeBlock>


</Slide>

---

<Slide>

# Live Region Examples

APG combobox?
Downshift?

</Slide>

---

<Slide>

# Live Region Gotchas & Tips

- Include [multiple regions](https://github.com/dequelabs/ngA11y) for stubborn situations
- Politeness levels depend on the use case
- Site-level announcement manager APIs <span role="img" aria-label="thumbs up">üëç</span>

https://github.com/AlmeroSteyn/react-aria-live

</Slide>

---

<Slide>

# Exercise
## Async action demo

http://localhost:8000/live-region

</Slide>

---

<Slide>

# Semantic HTML ‚ú®

- Use headings & landmarks
- Start wih native UI controls
- Build semantics into templates
- Verify assistive tech output

[WebAIM: Semantic Structure](https://webaim.org/techniques/semanticstructure/)

</Slide>

---

# Why semantics are important

> _Headings save time, and programattic information is useful_

<p style="max-width: 80%; margin: 0 auto;">
Semantic HTML communicates what's on a page to users of assistive technology, reader modes, conversational UIs, search engines, and more
</p>

---

<div class="visually-hidden">
# Semantics IRL
</div>

![An Event Apart homepage in Chrome DevTools](/aea-grid-inspect.png)

---

<Slide>

# Tools for testing semantics

- [Accessibility Insights: Headings](https://accessibilityinsights.io)
- [Firefox Web Developer Extension](https://addons.mozilla.org/en-US/firefox/addon/web-developer/):<br />_Information > View Document Outline_
- [axe browser extension](http://bit.ly/axe-chrome)
- [NVDA heading navigation, elements list](https://dequeuniversity.com/screenreaders/nvda-keyboard-shortcuts#nvda-the_basics)
- [Voiceover rotor](https://dequeuniversity.com/screenreaders/voiceover-keyboard-shortcuts#vo-mac-the-rotor)
- Browser reader modes

</Slide>

---

<Slide>

# Exercise!

## Semantics demo

http://localhost:8000/semantics

</Slide>

---

<Slide>

# Unobtrusive motion

Building safe _and_ delightful interfaces

- `prefers-reduced-motion` CSS
- media, animation playback controls
- opt-in for autoplay

https://source.opennews.org/articles/motion-sick/

</Slide>

---

<Slide>

# Unobtrusive animation demo

<AccessibleAnimationDemo></AccessibleAnimationDemo>

<div style="font-size: 2rem; margin-top: 2em;">
    <a href="https://codepen.io/marcysutton/pen/yqVVeY">https://codepen.io/marcysutton/pen/yqVVeY</a>
</div>

</Slide>

---

<Slide>

# prefers-reduced-motion

<CodeBlock title="CSS" side="left">

```css
@media (prefers-reduced-motion: reduce) {
    .animation {
        animation: none;
        transition: none;
    }
}
```

</CodeBlock>

<CodeBlock title="JavaScript" side="right">

```js
var motionQuery = matchMedia('(prefers-reduced-motion)');
function handleReduceMotionChanged() {
  if (motionQuery.matches) {
    /* adjust 'transition' or 'animation' properties */
  } else { 
    /* standard motion */
  }
}
motionQuery.addListener(handleReduceMotionChanged);
handleReduceMotionChanged(); // trigger once on load
```

</CodeBlock>

[WebKit guide](https://webkit.org/blog/7551/responsive-design-for-motion/) ~ [MDN docs](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion)


</Slide>

---

<Slide>

# Exercise!

## Play with reduced-motion<br />and CSS animation or transitions

http://localhost:8000/reduced-motion

</Slide>

---

<Slide>

# Progressive enhancement

- turning off JavaScript
- accessible baselines
- fallbacks
- challenges with frameworks

</Slide>

---

<Slide>

# SSR & Gatsby build

<CodeBlock>

```bash
gatsby build
```

</CodeBlock>

</Slide>

---

<Slide>

# Accessibility units

## component-level API concerns

</Slide>

---

# Detour: linting

["Being a good citizen of the web"](https://github.com/sveltejs/svelte/issues/374)

https://github.com/evcohen/eslint-plugin-jsx-a11y

---

<Slide>

# Automated unit test approach

- Test in isolation
- Stub inputs/fixture data
- Often headless
- Fast changing of state

</Slide>

---

<Slide>

# Component examples<br />with failing tests

- Accessible names
   - don't use "click here"
   - consider visible labels
- Keyboard interactions
- Toggling ARIA states

</Slide>

---

<Slide>

# Bonus unit test info

- configurable heading levels
- pass ARIA attributes into components

</Slide>

---

<Slide>

# Exercise

- Write an accessibility unit test!

</Slide>

---

<Slide>

# Accessible pages

## interrop of components

</Slide>

---

<Slide>

# Integration/end-to-end<br />testing approach

- Real-world browser testing
- Cypress vs. Selenium Webdriver
- Document/page-level accessibility rules: page title, HTML lang, color contrast, heading hierarchy
- Component interoperability
- Framework testing flexibility
- Accessibility testing APIs make more sense here as you can run an entire ruleset against each page

</Slide>

---

<Slide>

# Cypress example

</Slide>

---

<Slide>

# Puppeteer Accessibility tree example

https://pptr.dev/#?product=Puppeteer&version=v1.14.0&show=api-accessibilitysnapshotoptions

```js
const snapshot = await page.accessibility.snapshot();
const node = findFocusedNode(snapshot);
console.log(node && node.name);

function findFocusedNode(node) {
  if (node.focused)
    return node;
  for (const child of node.children || []) {
    const foundNode = findFocusedNode(child);
    return foundNode;
  }
  return null;
}
```

</Slide>

---

<Slide>

# Continuous Integration

An opportunity to test for accessibility on every commit, pull request, and deployment

</Slide>

---

<Slide>

# Gatsby examples

- Color contrast debugging
- Fix failing focus management tests
- Get Cypress tests passing on a page

</Slide>

---

# Spoiler: we need to do more

Automated testing and linting only gets us so far. Projects need manual human testing, too

---

<Slide>

# Accessibility resources

- http://bit.ly/a11y-resources
- http://bit.ly/a11y-manual-testing

</Slide>

---

<Slide>

# Accessibility<br />User Testing

- [Access Works](https://access-works.com/)
- [Fable Tech Labs](https://www.makeitfable.com/)

</Slide>

---

<Slide>

# Q & A

</Slide>
